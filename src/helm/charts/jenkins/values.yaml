# Jenkins Helm Chart Values for Bare Metal Environment

controller:
  # Jenkins image and version
  image: "jenkins/jenkins"
  tag: "lts-jdk17"
  
  # Resource limits and requests
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "4Gi"
      cpu: "2000m"
  
  # Node selector for big nodes
  nodeSelector:
    node-type: big
  
  # Tolerations for dedicated nodes
  tolerations:
  - key: "dedicated"
    operator: "Equal"
    value: "jenkins"
    effect: "NoSchedule"
  
  # Service configuration
  serviceType: LoadBalancer
  servicePort: 80
  targetPort: 8080
  
  # Persistence configuration
  persistence:
    enabled: true
    storageClass: "local-storage"
    size: 50Gi
    accessMode: ReadWriteOnce
  
  # Security configuration
  securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  
  # Health checks
  livenessProbe:
    httpGet:
      path: /login
      port: 8080
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /login
      port: 8080
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  # Jenkins Configuration as Code
  JCasC:
    enabled: true
    configScripts:
      jenkins-casc: |
        jenkins:
          systemMessage: "Jenkins configured automatically by Jenkins Configuration as Code plugin"
          numExecutors: 2
          scmCheckoutRetryCount: 3
          mode: NORMAL
          labelString: "jenkins-big"
          globalNodeProperties:
            - envVars:
                - env:
                    - key: "JAVA_HOME"
                      value: "/usr/local/openjdk-17"
          securityRealm:
            local:
              allowsSignup: false
              users:
                - id: "admin"
                  password: "admin"
          authorizationStrategy:
            globalMatrix:
              permissions:
                - "Overall/Administer:admin"
                - "Overall/Read:authenticated"
          crumbIssuer:
            standard:
              excludeClientIPFromCrumb: false
          disableRememberMe: false
          markupFormatter: plainText
          tool:
            git:
              installations:
                - name: "Default"
                  home: "git"
            maven:
              installations:
                - name: "Maven"
                  home: "/usr/local/maven"
            jdk:
              installations:
                - name: "JDK17"
                  home: "/usr/local/openjdk-17"
                  properties:
                    - installSource:
                        installers:
                          - jdkInstaller:
                              id: "jdk-17.0.2+8"
          unclassified:
            location:
              url: http://jenkins.jenkins.svc.cluster.local
            gitHubConfiguration:
              apiRateLimitChecker: ThrottleForNormalize
            gitHubPluginConfiguration:
              apiRateLimitChecker: ThrottleForNormalize
  
  # Environment variables
  env:
  - name: JAVA_OPTS
    value: "-Djenkins.install.runSetupWizard=false"
  - name: JENKINS_OPTS
    value: "--prefix=/jenkins"
  
  # Ingress configuration
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/rewrite-target: /
    hosts:
    - host: jenkins.local
      paths:
      - path: /
        pathType: Prefix
    tls: []

# Agent configuration
agent:
  enabled: true
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"

# Backup configuration
backup:
  enabled: false
  # Uncomment to enable backup
  # schedule: "0 2 * * *"
  # storageClass: "local-storage"
  # size: 10Gi

# Monitoring
serviceMonitor:
  enabled: true
  interval: 30s 