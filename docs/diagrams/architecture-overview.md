# Architecture Overview / Обзор архитектуры

[English](#english) | [Русский](#russian)

## English

### High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    Kubernetes Baremetal Lab                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────┐  │
│  │   Load Balancer │    │   Load Balancer │    │   Load      │  │
│  │   (HAProxy)     │    │   (MetalLB)     │    │   Balancer  │  │
│  └─────────────────┘    └─────────────────┘    └─────────────┘  │
│           │                       │                     │       │
│           ▼                       ▼                     ▼       │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Control Plane Nodes                      │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │ Master Node │  │ Master Node │  │ Master Node │        │ │
│  │  │     1       │  │     2       │  │     3       │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Worker Nodes                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Big Node  │  │ Medium Node │  │  Small Node │        │ │
│  │  │   (Jenkins) │  │ (Ingress)   │  │  (Dev/Test) │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Big Node  │  │ Medium Node │  │  Small Node │        │ │
│  │  │ (Grafana)   │  │ (Apps)      │  │  (Dev/Test) │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Big Node  │  │ Medium Node │  │  Small Node │        │ │
│  │  │ (ArgoCD)    │  │ (Apps)      │  │  (Dev/Test) │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

### Network Architecture

```
Internet
    │
    ▼
┌─────────────────┐
│   Load Balancer │  ← HAProxy/Nginx (192.168.1.100)
│   (External)    │
└─────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│                    Kubernetes Cluster                       │
│                                                             │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   Control Plane │    │   Worker Nodes  │                │
│  │   (192.168.1.10)│    │   (192.168.1.20)│                │
│  │   (192.168.1.11)│    │   (192.168.1.21)│                │
│  │   (192.168.1.12)│    │   (192.168.1.22)│                │
│  └─────────────────┘    └─────────────────┘                │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                 Pod Network (10.244.0.0/16)            │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │ │
│  │  │   Jenkins   │  │   Grafana   │  │   ArgoCD    │    │ │
│  │  │   Pod       │  │   Pod       │  │   Pod       │    │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │               Service Network (10.96.0.0/12)           │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### Storage Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    Storage Architecture                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   Local Storage │    │   NFS Storage   │                │
│  │   (SSD/HDD)     │    │   (Shared)      │                │
│  │                 │    │                 │                │
│  │  ┌─────────────┐│    │  ┌─────────────┐│                │
│  │  │   Jenkins   ││    │  │   Artifacts ││                │
│  │  │   Data      ││    │  │   Storage   ││                │
│  │  └─────────────┘│    │  └─────────────┘│                │
│  │                 │    │                 │                │
│  │  ┌─────────────┐│    │  ┌─────────────┐│                │
│  │  │   Grafana   ││    │  │   Logs      ││                │
│  │  │   Data      ││    │  │   Storage   ││                │
│  │  └─────────────┘│    │  └─────────────┘│                │
│  └─────────────────┘    └─────────────────┘                │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              Storage Classes                            │ │
│  │  • local-storage (default)                              │ │
│  │  • ssd-storage (high performance)                       │ │
│  │  • hdd-storage (standard)                               │ │
│  │  • nfs-storage (shared)                                 │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### Application Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                  Application Stack                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   Ingress       │    │   Load Balancer │                │
│  │   Controller    │    │   (MetalLB)     │                │
│  └─────────────────┘    └─────────────────┘                │
│           │                       │                        │
│           ▼                       ▼                        │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              Application Services                       │ │
│  │                                                         │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │ │
│  │  │   Jenkins   │  │   Grafana   │  │   ArgoCD    │    │ │
│  │  │   (CI/CD)   │  │ (Monitoring)│  │  (GitOps)   │    │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │ │
│  │                                                         │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │ │
│  │  │ Artifactory │  │ Prometheus  │  │ Lab Apps    │    │ │
│  │  │ (Artifacts) │  │ (Metrics)   │  │ (Testing)   │    │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              Data Layer                                 │ │
│  │  • Persistent Volumes                                   │ │
│  │  • ConfigMaps                                           │ │
│  │  • Secrets                                              │ │
│  │  • Storage Classes                                      │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## Русский

### Архитектура высокого уровня

```
┌─────────────────────────────────────────────────────────────────┐
│                    Kubernetes Baremetal Lab                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────┐  │
│  │   Балансировщик │    │   Балансировщик │    │   Баланси-  │  │
│  │   нагрузки      │    │   нагрузки      │    │   ровщик    │  │
│  │   (HAProxy)     │    │   (MetalLB)     │    │   нагрузки  │  │
│  └─────────────────┘    └─────────────────┘    └─────────────┘  │
│           │                       │                     │       │
│           ▼                       ▼                     ▼       │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Узлы Control Plane                       │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │ Master Node │  │ Master Node │  │ Master Node │        │ │
│  │  │     1       │  │     2       │  │     3       │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Worker узлы                              │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Big Node  │  │ Medium Node │  │  Small Node │        │ │
│  │  │   (Jenkins) │  │ (Ingress)   │  │  (Dev/Test) │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Big Node  │  │ Medium Node │  │  Small Node │        │ │
│  │  │ (Grafana)   │  │ (Apps)      │  │  (Dev/Test) │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Big Node  │  │ Medium Node │  │  Small Node │        │ │
│  │  │ (ArgoCD)    │  │ (Apps)      │  │  (Dev/Test) │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

### Сетевая архитектура

```
Интернет
    │
    ▼
┌─────────────────┐
│   Балансировщик │  ← HAProxy/Nginx (192.168.1.100)
│   нагрузки      │
│   (Внешний)     │
└─────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│                    Кластер Kubernetes                       │
│                                                             │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   Control Plane │    │   Worker узлы   │                │
│  │   (192.168.1.10)│    │   (192.168.1.20)│                │
│  │   (192.168.1.11)│    │   (192.168.1.21)│                │
│  │   (192.168.1.12)│    │   (192.168.1.22)│                │
│  └─────────────────┘    └─────────────────┘                │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                 Сеть подов (10.244.0.0/16)             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │ │
│  │  │   Jenkins   │  │   Grafana   │  │   ArgoCD    │    │ │
│  │  │   Pod       │  │   Pod       │  │   Pod       │    │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘    │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │               Сеть сервисов (10.96.0.0/12)             │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### Компоненты системы

#### 1. **Control Plane Components**
- **API Server**: REST API для управления кластером
- **etcd**: Распределенное хранилище конфигурации
- **Scheduler**: Планировщик размещения подов
- **Controller Manager**: Управление состоянием кластера

#### 2. **Worker Node Components**
- **Kubelet**: Агент узла для управления подами
- **Container Runtime**: containerd для запуска контейнеров
- **Kube-proxy**: Сетевой прокси для сервисов
- **CNI Plugin**: Flannel для сетевого взаимодействия

#### 3. **Application Components**
- **Jenkins**: CI/CD pipeline
- **Grafana**: Мониторинг и визуализация
- **ArgoCD**: GitOps управление
- **Artifactory**: Управление артефактами
- **Prometheus**: Сбор метрик

#### 4. **Network Components**
- **MetalLB**: Load balancer для bare metal
- **Ingress Controller**: Nginx для внешнего доступа
- **CoreDNS**: DNS разрешение в кластере

#### 5. **Storage Components**
- **Local Storage**: Локальные тома на узлах
- **NFS Storage**: Сетевое хранилище
- **Storage Classes**: Абстракция хранилища 